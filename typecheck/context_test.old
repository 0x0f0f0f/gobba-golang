package typecheck

import (
	"github.com/0x0f0f0f/gobba-golang/ast"
	// "github.com/0x0f0f0f/gobba-golang/lexer"
	// "github.com/0x0f0f0f/gobba-golang/parser"
	"testing"

	"github.com/stretchr/testify/assert"
)

var alphaid ast.UniqueIdentifier = ast.GenUID("alpha")
var betaid ast.UniqueIdentifier = ast.GenUID("beta")
var gammaid ast.UniqueIdentifier = ast.GenUID("gamma")
var deltaid ast.UniqueIdentifier = ast.GenUID("delta")
var epsilonid ast.UniqueIdentifier = ast.GenUID("epsilon")

var alphaext CtxValue = &CtxExSort{
	Identifier: alphaid,
}
var betaext CtxValue = &CtxExSort{
	Identifier: betaid,
}
var gammaext CtxValue = &CtxExSort{
	Identifier: gammaid,
}
var deltaext CtxValue = &CtxExSort{
	Identifier: deltaid,
}
var epsilonext CtxValue = &CtxExSort{
	Identifier: epsilonid,
}

var alphauniv CtxValue = &CtxUnVar{
	Identifier: alphaid,
}
var betauniv CtxValue = &CtxUnVar{
	Identifier: betaid,
}
var gammauniv CtxValue = &CtxUnVar{
	Identifier: gammaid,
}
var deltauniv CtxValue = &CtxUnVar{
	Identifier: deltaid,
}
var epsilonuniv CtxValue = &CtxUnVar{
	Identifier: epsilonid,
}

var SampleContext1 Context = Context{
	Contents: []CtxValue{
		alphaext,
		betaext,
		gammauniv,
	},
}

func TestInsert(t *testing.T) {
	tests := []struct {
		Cont    Context
		El      CtxValue
		Inserts []CtxValue
		Result  Context
	}{
		{SampleContext1, betaext, []CtxValue{epsilonext, deltaext},
			Context{
				Contents: []CtxValue{alphaext, epsilonext, deltaext, gammauniv},
			}},
		{SampleContext1, gammaext, []CtxValue{epsilonext, deltaext},
			Context{
				Contents: []CtxValue{alphaext, betaext, gammauniv, epsilonext, deltaext},
			}},
	}

	for _, tt := range tests {
		nc := tt.Cont.Insert(tt.El, tt.Inserts)

		assert.Equal(t, tt.Result, nc)
	}
}

func TestDrop(t *testing.T) {
	tests := []struct {
		Cont   Context
		El     CtxValue
		Result Context
	}{
		{SampleContext1, betaext,
			Context{
				Contents: []CtxValue{alphaext, gammauniv},
			}},
		{SampleContext1, gammauniv,
			Context{
				Contents: []CtxValue{alphaext, betaext},
			}},
		{SampleContext1, deltaext,
			Context{
				Contents: []CtxValue{alphaext, betaext, gammauniv},
			}},
	}

	for _, tt := range tests {
		nc := tt.Cont.Drop(tt.El)

		assert.Equal(t, tt.Result, nc)
	}
}
